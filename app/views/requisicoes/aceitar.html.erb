<%= javascript_include_tag :defaults %>
<%= javascript_include_tag "aceitar_requisicao.js" %>
<%= calendar_date_select_includes "silver", :locale => "pt"%>
<%= javascript_include_tag "calendar_date_select/format_italian" %>


<div class="show_padrao">

        <!---------------------------------------------------------------------------->

  <div class="formularios_embutidos">
  <% form_tag :controller => "requisicoes", :action => "fechar_viagem", :id => @requisicao.id do %>
    <fieldset>
      <legend>Detalhes da viagem</legend>
      <%= mensagem_de_erro(@viagem) %>
      <%= mensagem_de_erro @requisicao %>

      <%= radio_button_tag :escolha_de_viagem, "nova", true, :onclick => "viagemNovaOuExistente()" %>
      <%= label_tag :escolha_de_viagem_nova, "Atender com uma nova viagem: ", :id => "label_viagem_nova" %>
      <br class="pular_linha"/>

      <%= radio_button_tag :escolha_de_viagem, "existente", false, :onclick => "viagemNovaOuExistente()" %>
      <%= label_tag :escolha_de_viagem_existente, "Atender com uma viagem já existente: ", :id => "label_viagem_existente" %>
      <br class="pular_linha"/>

      <!-- VIAGEM NOVA ----------------------------------------------------- -->
      <div id="viagem_nova">
        <label for="viagem_data_de_saida">Data de sa&iacute;da:</label>
        <%= calendar_date_select_tag "viagem_data_de_saida",
                                    @viagem.data_partida ? @viagem.data_partida.to_date.to_s_br : "",
                                    :name => "data_saida",
                                    :year_range => [0.years.ago, 2.years.from_now],
                                    :month_year => "label",
                                    :class => "campo_data"%> <br class="pular_linha"/>



        <label for="viagem_data_de_chegada">Data de chegada:</label>
        <%= calendar_date_select_tag "viagem_data_de_chegada",
                                    @viagem.data_chegada ? @viagem.data_chegada.to_date.to_s_br : "",
                                    :name => "data_chegada",
                                    :year_range => [0.years.ago, 2.years.from_now],
                                    :month_year => "label",
                                    :class => "campo_data"%> <br class="pular_linha"/>

        <label for="horario_partida">Hor&aacute;rio de saída:</label>
        <%= time_select :horario, :partida, {:time_separator => ':', :minute_step => 5, :include_blank => "-"}%> <br class="pular_linha"/>

        <label for="motorista_id">Motorista:</label>
        <%= collection_select :motorista, :id, Motorista.all, :id, :nome_do_motorista, {:include_blank => "Selecione um motorista"} %> <br class="pular_linha"/>

        <label for="veiculo">Ve&iacute;culo:</label> <br class="pular_linha"/>
      </div>

      <!-- VIAGEM EXISTENTE ------------------------------------------------ -->
      <div id="viagens_existentes">
        <table id="viagens" class="tabela_padrao">
          <tr>
            <th>Estado</th>
            <th>Data de partida</th>
            <th>Data de chegada</th>
            <th>Hor&aacute;rio de partida</th>
            <th>Motorista</th>
            <th>Ve&iacute;culo</th>
            <th>Requisi&ccedil;&atilde;o(s) atendida(s)</th>
            <th>Escolha</th>
          </tr>

        <% @viagens.each do |viagem|%>

          <tr>
            <%= "<td class=\""%><%=h viagem.estado.downcase.gsub(" ", "_") %><%= "\">"%>
              <%=h viagem.estado %>
            <%= "</td>"%>
            <td><%=h (viagem.data_partida.strftime("%d/%m/%Y")) if viagem.data_partida %></td>
            <td><%=h (viagem.data_chegada.strftime("%d/%m/%Y")) if viagem.data_chegada %></td>
            <td><%=h (viagem.horario_partida.strftime("%H : %M")) if (viagem.horario_partida) %></td>
            <td><%=h (viagem.motorista.nome_do_motorista) if viagem.motorista  %></td>
            <td></td>
            <td></td>
            <td><%= radio_button_tag :id_da_viagem, viagem.id, false%></td>
          </tr>

        <% end %>

        </table>
      </div>

      <%= submit_tag "Concluir", :class => "botao_concluir" %>

    </fieldset>
  <% end %>

  </div>

        <!---------------------------------------------------------------------------->

    <h1>Dados gerais</h1>

    <div class="show_linha">
      <div class="linha_titulo"> Matricula: </div> <div class="linha_texto"> <%=h @solicitante.matricula %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Nome do solicitante: </div> <div class="linha_texto"> <%=h @solicitante.nome %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Email: </div> <div class="linha_texto"> <%=h @solicitante.email %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Cargo ou funcao: </div> <div class="linha_texto"> <%=h @requisicao.cargo_ou_funcao %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Telefone ou ramal: </div> <div class="linha_texto"> <%=h @requisicao.telefone_ou_ramal %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Celular: </div> <div class="linha_texto"> <%=h @requisicao.celular %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Laboratorio ou setor: </div> <div class="linha_texto"> <%=h @requisicao.laboratorio_ou_setor %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Predio: </div> <div class="linha_texto"> <%=h @requisicao.predio %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Andar: </div> <div class="linha_texto"> <%=h @requisicao.andar %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Sala: </div> <div class="linha_texto"> <%=h @requisicao.sala %> </div>
    </div>

    <h1>Dados da reserva</h1>

    <div class="show_linha">
      <div class="linha_titulo"> Data de reserva: </div> <div class="linha_texto"> <%=h @requisicao.data_de_reserva.strftime("%d/%m/%Y")%> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Categoria do veículo: </div> <div class="linha_texto"> <%=h CategoriaDeVeiculo.find(@requisicao.categoria_de_veiculo_id).nome %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Objetivo da reserva: </div> <div class="linha_texto"> <%=h @requisicao.objetivo_da_reserva %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Outros: </div> <div class="linha_texto"> <%=h @requisicao.outros %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Nome e telefone dos passageiros: </div> <div class="linha_texto"> <%=h @requisicao.nome_telefone_passageiros %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Roteiro da agenda: </div> <div class="linha_texto"> <%=h @requisicao.roteiro_da_agenda %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Observacao: </div> <div class="linha_texto"> <%=h @requisicao.observacao %> </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo"> Estado: </div> <div class="linha_texto"> <%=h @requisicao.estado.to_s %> </div>
    </div>

</div>

<!---------------------------------------------------------------------------->

<div id="opcoes_da_visao">
  <ul>
    <li id="opcao_voltar" onclick="location.href='<%= requisicoes_path %>'" onmouseover="this.style.cursor='pointer'"><%= link_to 'Voltar', requisicoes_path %></li>
  </ul>
  <div class="pular_linha"></li>
</div>

