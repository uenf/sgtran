<%= javascript_include_tag :defaults %>
<%= javascript_include_tag "viagem_nova_existente.js" %>
<%= calendar_date_select_includes "silver", :locale => "pt"%>
<%= javascript_include_tag "calendar_date_select/format_italian" %>

<div class="show_padrao">
  <h1>Editar viagem</h1>

  <div class="formularios_embutidos">
    <% form_tag :controller => "viagem", :action => "update", :id => @viagem.id do %>
      <fieldset>
        <legend>Detalhes da viagem</legend>
        <%= mensagem_de_erro(@viagem) %>

      <div id="viagem_nova_existente">
        <fieldset>
          <legend>Atender com uma viagem:</legend>
            <%= radio_button_tag :escolha_de_viagem, "nova", true, :onclick => "viagemNovaOuExistente()" %>
            <%= label_tag :escolha_de_viagem_nova, "Nova: ", :id => "label_viagem_nova" %>
            <br class="pular_linha"/>

            <%= radio_button_tag :escolha_de_viagem, "existente", false, :onclick => "viagemNovaOuExistente()" %>
            <%= label_tag :escolha_de_viagem_existente, "Existente: ", :id => "label_viagem_existente" %>
            <br class="pular_linha"/>
        </fieldset>
      </div>

      <!-- VIAGEM NOVA ----------------------------------------------------- -->
      <div id="viagem_nova">
      <fieldset>
        <legend>Dados da nova viagem:</legend>
          <label for="viagem_data_de_saida">Data de sa&iacute;da:</label>
          <%= calendar_date_select_tag "viagem_data_de_saida",
                                      @viagem.data_partida ? @viagem.data_partida.to_date.to_s_br : "",
                                      :name => "data_saida",
                                      :year_range => [0.years.ago, 2.years.from_now],
                                      :month_year => "label",
                                      :class => "campo_data"%> <br class="pular_linha"/>

          <%= observe_field :viagem_data_de_saida,
                            :url => { :controller => :requisicoes,
                              :action => :opcoes_motoristas },
                            :update => :motorista_id,
                            :with => "'data_partida=' + document.getElementById('viagem_data_de_saida').value + '&data_chegada=' + document.getElementById('viagem_data_de_chegada').value"
                            %>

          <%= observe_field :viagem_data_de_saida,
                            :url => { :controller => :requisicoes,
                              :action => :opcoes_veiculos },
                            :update => :veiculo_id,
                            :with => "'data_partida=' + document.getElementById('viagem_data_de_saida').value + '&data_chegada=' + document.getElementById('viagem_data_de_chegada').value + '&categoria_de_veiculo_id=' + '#{@requisicao.categoria_de_veiculo_id}'"
                            %>

          <label for="viagem_data_de_chegada">Data de chegada:</label>
          <%= calendar_date_select_tag "viagem_data_de_chegada",
                                      @viagem.data_chegada ? @viagem.data_chegada.to_date.to_s_br : "",
                                      :name => "data_chegada",
                                      :year_range => [0.years.ago, 2.years.from_now],
                                      :month_year => "label",
                                      :class => "campo_data"%>
          <br class="pular_linha"/>

          <%= observe_field :viagem_data_de_chegada,
                            :url => { :controller => :requisicoes,
                              :action => :opcoes_motoristas },
                            :update => :motorista_id,
                            :with => "'data_partida=' + document.getElementById('viagem_data_de_saida').value + '&data_chegada=' + document.getElementById('viagem_data_de_chegada').value"
                            %>

          <%= observe_field :viagem_data_de_chegada,
                            :url => { :controller => :requisicoes,
                              :action => :opcoes_veiculos },
                            :update => :veiculo_id,
                            :with => "'data_partida=' + document.getElementById('viagem_data_de_saida').value + '&data_chegada=' + document.getElementById('viagem_data_de_chegada').value + '&categoria_de_veiculo_id=' + '#{@requisicao.categoria_de_veiculo_id}'"
                            %>

          <label for="horario_partida">Hor&aacute;rio de sa&iacute;da:</label>
          <%= time_select :horario, :partida, {:time_separator => ':', :minute_step => 5, :include_blank => "-"}%>
          <br class="pular_linha"/>

          <label for="motorista_id">Motorista:</label>
          <select name="motorista_id" id="motorista_id">
            <%= grouped_options_for_select(@lista_motoristas, "", "Selecione um motorista") %>
          </select>
          <br class="pular_linha"/>


          <label for="veiculo_id">Ve&iacute;culo:</label>
          <select name="veiculo_id" id="veiculo_id">
            <%= grouped_options_for_select(@lista_veiculos, "", "Selecione um ve&iacute;culo") %>
          </select>
          <br class="pular_linha"/>
        </fieldset>
      </div>

    <% end %>
  </div>
</div>

<div id="opcoes_da_visao">
  <ul>
    <li id="opcao_voltar" onclick="history.back(-1)" onmouseover="this.style.cursor = 'pointer'">Voltar</li>
  </ul>
</div>

