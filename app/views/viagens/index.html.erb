<%= javascript_include_tag :defaults %>
<%= javascript_include_tag "busca.js" %>
<%= calendar_date_select_includes "silver", :locale => "pt"%>
<%= javascript_include_tag "calendar_date_select/format_italian" %>
<div id="tabela_exibir">

<div id="box_busca">
  <div id="box_buscar">
    <% form_tag("/viagens/buscar_viagem") do -%>
    <div id="buscar_select">
      <%= label_tag :busca, "Buscar por:" %>
      <select name="busca" id="busca">
        <option onclick="busca_viagem(this)" value="(Selecionar)">(Selecionar)</option>
        <option value="Data de partida" onclick="busca_viagem(this)">Data de Partida</option>
        <option value="Data de chegada" onclick="busca_viagem(this)">Data de Chegada</option>
        <option value="Motorista" onclick="busca_viagem(this)">Motorista</option>
      </select>
    </div>
    <div <%= @data_de_partida.nil? ? 'class="invisivel"' : 'class="visivel"' %> id="box_data_de_partida">
      <%= label_tag :data_de_partida, "Data de Partida:" %>
      <%= calendar_date_select_tag :data_de_partida, @data_de_partida, :name => "data_de_partida", :size => 9 %>
    </div>

    <div <%= @data_de_chegada.nil? ? 'class="invisivel"' : 'class="visivel"' %> id="box_data_de_chegada">
      <%= label_tag :data_de_chegada, "Data de Chegada:" %>
      <%= calendar_date_select_tag :data_de_chegada, @data_de_chegada, :name => "data_de_chegada", :size => 9 %>
    </div>

    <div <%= @motorista.nil? ? 'class="invisivel"' : 'class="visivel"' %> id="box_motorista">
      <%= label_tag :motorista, "Nome:" %>
      <%= text_field_tag :motorista %>
    </div>

    <%= submit_tag "Buscar" %>
    <div class="clear"></div>
  <% end -%>
  </div>

  <div id="box_filtrar">
    <% form_tag("/filtrar_viagem") do -%>
    <p class="filtro">
    <%= label_tag :filtro, "Filtrar por:" %>
      <select name="filtro" id="filtro">
        <option value="Todos" <%= "selected='selected'" if @filtro == "Todos" %>>Todos</option>
        <option value="Aguardando" <%= "selected='selected'" if @filtro == "Aguardando" or !@filtro %>>Aguardando</option>
        <option value="Cancelada" <%= "selected='selected'" if @filtro == "Cancelada" %>>Cancelada</option>
        <option value="Atendida" <%= "selected='selected'" if @filtro == "Atendida" %>>Atendida</option>
      </select>
      <%= submit_tag "OK" %>
      </p>
    <% end -%>
  </div>
  <div class="clear"></div>
</div>

  <table class="tabela_padrao" id="viagens">
    <tr>
      <th>Estado</th>
      <th>Data de partida</th>
      <th>Data de chegada</th>
      <th>Hor&aacute;rio de partida</th>
      <th>Solicitantes</th>
      <th>Motorista</th>
      <th>Ve&iacute;culo</th>
      <th>Requisi&ccedil;&atilde;o(s) atendida(s)</th>
    </tr>
<% @viagens.each do |viagem| %>
  <% (veiculo = Veiculo.find(viagem.veiculo_id)) if viagem.veiculo_id%>
  <tr onmouseover="this.style.cursor='pointer'" onclick="location.href='<%= viagem_path(viagem) %>'">
    <%= "<td class=\""%><%=h viagem.estado.downcase.gsub(" ", "_") %><%= "\">"%>
      <%=h viagem.estado %>
    <%= "</td>"%>
    <td><%=h (viagem.data_partida.strftime("%d/%m/%Y")) if viagem.data_partida %></td>
    <td><%=h (viagem.data_chegada.strftime("%d/%m/%Y")) if viagem.data_chegada %></td>
    <td><%=h (viagem.horario_partida.strftime("%H : %M")) if (viagem.horario_partida) %></td>
    <td><%=h viagem.nomes_solicitantes.to_sentence  %></td>
    <td><%=h (viagem.motorista.nome) if viagem.motorista  %></td>
    <td>
    <%=h veiculo.modelo + " - " +
        veiculo.placa + " - " +
        CategoriaDeVeiculo.find(veiculo.categoria_de_veiculo_id).nome if veiculo
        %>
  </td>
  <td><%=h viagem.requisicoes_atendidas.to_sentence %></td>
  <td onclick="location.href='<%= edit_viagem_path(viagem) %>'" onmouseover="this.style.cursor='pointer'"><%= link_to image_tag("editar_dado.png", :border => 0, :alt => "Editar"), edit_viagem_path(viagem) %></td>
  </tr>
<% end %>
  </table>
</div>

