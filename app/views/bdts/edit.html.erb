<%= javascript_include_tag :defaults %>
<%= calendar_date_select_includes "silver", :locale => "pt"%>
<%= javascript_include_tag "calendar_date_select/format_italian" %>

<div class="show_padrao">

  <h1>Editar BDT</h1>

  <% form_for(@bdt) do |f| %>
    <%= mensagem_de_erro(@bdt) %>
    <%= hidden_field_tag 'viagem_id', @viagem.id %>

    <div class="show_linha">
      <div class="linha_titulo">
        <%= f.label :numero, "Número físico", :class => "label_obrigatorio" %>
      </div>
      <div class="linha_texto_neutro">
        <%= f.text_field :numero, :class => "campo_de_poucos_digitos" %>
      </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo">
        <%= label_tag :veiculo_id, "Veículo", :class => "label_obrigatorio" %>
      </div>
      <div class="linha_texto_neutro">
        <%= collection_select :veiculo, :id, Veiculo.all, :id,
                              :formatacao_para_bdt,
                              {:prompt => "Selecione um veículo"} %>
      </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo">
        <%= label_tag :motorista_id, "Condutor", :class => "label_obrigatorio" %>
      </div>
      <div class="linha_texto_neutro">
        <%= collection_select :motorista, :id, Motorista.all, :id, :nome,
                              {:prompt => "Selecione um condutor"} %>
      </div>
    </div>

    <fieldset>
      <legend>Partida:</legend>
      <div class="show_linha">
        <div class="linha_titulo">
          <%= f.label :data_partida, "Data", :class => "label_obrigatorio" %>
        </div>
        <div class="linha_texto_neutro">
          <%= calendar_date_select_tag "bdt_data_partida",
                                @bdt.data_partida.to_s_br,
                                :name => "bdt[data_partida]",
                                :year_range => [0.years.ago, 2.years.from_now],
                                :month_year => "label",
                                :class => "campo_de_poucos_digitos"%>
        </div>
      </div>

      <div class="show_linha">
        <div class="linha_titulo">
          <label for="bdt_horario_partida" style="display:none;">Horário de partida</label>
          <%= f.label :horario_partida, "Horário", :class => "label_obrigatorio" %>
        </div>
        <div class="linha_texto_neutro">
          <%= time_select 'bdt', 'horario_partida',
                          {:prompt => @bdt_horario_partida,
                           :ignore_date => true} %>
        </div>
      </div>

      <div class="show_linha">
        <div class="linha_titulo">
          <%= f.label :odometro_partida, "Odômetro", :class => "label_obrigatorio" %>
        </div>
        <div class="linha_texto_neutro">
          <%= f.text_field :odometro_partida, :class => "campo_de_poucos_digitos" %>
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Recolhimento:</legend>
      <div class="show_linha">
        <div class="linha_titulo">
          <label for="bdt_horario_recolhimento" style="display:none;">Horário de recolhimento</label>
          <%= f.label :data_recolhimento, "Data", :class => "label_obrigatorio" %>
        </div>
        <div class="linha_texto_neutro">
          <%= calendar_date_select_tag "bdt_data_recolhimento",
                              @bdt.data_recolhimento.to_s_br,
                              :name => "bdt[data_recolhimento]",
                              :year_range => [0.years.ago, 2.years.from_now],
                              :month_year => "label",
                              :class => "campo_de_poucos_digitos"%>
        </div>
      </div>

      <div class="show_linha">
        <div class="linha_titulo">
          <%= f.label :horario_recolhimento, "Horário", :class => "label_obrigatorio" %>
        </div>
        <div class="linha_texto_neutro">
          <%= time_select 'bdt', 'horario_recolhimento',
                          {:prompt => @bdt_horario_recolhimento,
                           :ignore_date => true} %>
        </div>
      </div>


      <div class="show_linha">
        <div class="linha_titulo">
          <%= f.label :odometro_recolhimento, "Odômetro", :class => "label_obrigatorio" %>
        </div>
        <div class="linha_texto_neutro">
          <%= f.text_field :odometro_recolhimento, :class => "campo_de_poucos_digitos" %>
        </div>
      </div>
    </fieldset>

    <% @requisicoes_ids.each do |id| %>
      <fieldset>
        <legend>Requisicao <%= id %></legend>

        Origem

        <div class="show_linha">
          <div class="linha_titulo">
            <%= label_tag "estado_origem[#{id}]", "Estado" %>
          </div>
          <div class="linha_texto_neutro">
            <%= select_tag "estado_origem[#{id}]",
              Estado.all.collect { |e| [ "<option>#{e.sigla}</option>" ] },
              {:include_blank => "-"} %>
          </div>
        </div>

        <%= observe_field "estado_origem[#{id}]",
                  :url => { :controller => :bdts,
                    :action => :cidades_por_estado },
                  :update => "cidade_origem[#{id}]",
                  :with => "'sigla_estado=' + document.getElementById('estado_origem#{id}').value"
                  %>

        <div class="show_linha">
          <div class="linha_titulo">
            <%= label_tag "cidade_origem[#{id}]", "Cidade" %>
          </div>
          <div class="linha_texto_neutro">
            <%= select_tag "cidade_origem[#{id}]",
              Cidade.all.collect { |c| [ "<option value='#{c.id}'>#{c.nome}</option>" ] },
              {:include_blank => "-"} %>
          </div>
        </div>

        Destino

        <div class="show_linha">
          <div class="linha_titulo">
            <%= label_tag "estado_destino[#{id}]", "Estado" %>
          </div>
          <div class="linha_texto_neutro">
            <%= select_tag "estado_destino[#{id}]",
              Estado.all.collect { |e| [ "<option>#{e.sigla}</option>" ] },
              {:include_blank => "-"} %>
          </div>
        </div>

        <%= observe_field "estado_destino[#{id}]",
                  :url => { :controller => :bdts,
                    :action => :cidades_por_estado },
                  :update => "cidade_destino[#{id}]",
                  :with => "'sigla_estado=' + document.getElementById('estado_origem#{id}').value"
                  %>

        <div class="show_linha">
          <div class="linha_titulo">
            <%= label_tag "cidade_destino[#{id}]", "Cidade" %>
          </div>
          <div class="linha_texto_neutro">
            <%= select_tag "cidade_destino[#{id}]",
              Cidade.all.collect { |c| [ "<option value='#{c.id}'>#{c.nome}</option>" ] },
              {:include_blank => "-"} %>
          </div>
        </div>
      </fieldset>
    <% end %>

    <div class="show_linha">
      <div class="linha_titulo">
        <%= f.label :local_destino, "Local destino" %>
      </div>
      <div class="linha_texto_neutro">
        <%= f.text_field :local_destino %>
      </div>
    </div>

    <div class="show_linha">
      <div class="linha_titulo">
        <%= f.label :objetivo, "Objetivo" %>
      </div>
      <div class="linha_texto_neutro">
        <%= f.text_area :objetivo %>
      </div>
    </div>

    <div class="botao_concluir"><%= f.submit 'Atualizar' %></div>
  <% end %>
</div>

<div id="opcoes_da_visao">
  <ul>
    <li id="opcao_voltar" onclick="history.back(-1)" onmouseover="this.style.cursor = 'pointer'">Voltar</li>
  </ul>
</div>

