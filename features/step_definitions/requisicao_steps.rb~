require "factory_girl"

Dado /^que eu estou na (.+)$/ do |page_name|
  visit path_to(page_name)
end

Dado /^que eu tenho uma requisição de ida com número de protocolo ([^\"]*)$/ do |protocolo|
  @requisicao_ida = Factory.create :requisicao, :tipo => "Ida", :id => protocolo, :solicitante_id => @solicitante.id
end

Dado /^que eu tenho uma requisição de volta com número de protocolo ([^\"]*)$/ do |protocolo|
  @requisicao_volta = Factory.create :requisicao, :tipo => "Volta", :id => protocolo, :solicitante_id => @solicitante.id
  @requisicao_volta.referencia_id = @requisicao_ida.id
  @requisicao_ida.referencia_id = @requisicao_volta.id
  @requisicao_volta.save!
  @requisicao_ida.save!
end

Dado /^que eu eu tenho uma data de dois dias seguintes a partir de hoje$/ do
  @data = Date.tomorrow.tomorrow
end

Dado /^que eu tenha um solicitante com e-mail "([^\"]*)" e matricula "([^\"]*)"$/ do |email, matricula|
  @solicitante = Factory.create :solicitante, :email => email, :matricula => matricula
end

Dado /^que eu tenha uma requisição em espera$/ do
  solicitante = Factory.create :solicitante
  @requisicao = Factory.create :requisicao, :solicitante_id => solicitante.id
end

Dado /^que eu estou logado com o login "([^\"]*)" e a senha "([^\"]*)"$/ do |login, senha|
  usuario = Factory.create :usuario, :login => login, :password => senha, :password_confirmation => senha
  Factory.create :usuario_session, :login => usuario.login, :senha => usuario.password
end

Quando /^eu escolho "([^\"]*)"$/ do |field|
  choose(path_to(field))
end

Dado /^que eu tenho "([^\"]*)" em Motorista$/ do |nome|
  Factory.create :motorista, :nome_do_motorista => nome
end

Entao /^eu devo ter uma nova viagem$/ do
  viagem = Factory.create :viagem
  Requisicao.update(@requisicao.id, :viagem_id => viagem.id)
  @requisicao.viagem_id = viagem.id
  @viagem_id = viagem.id + 1
end

Quando /^eu preencho "([^\"]*)" com uma data de dois dias seguintes a partir de hoje$/ do |campo|
  fill_in(campo, :with => Date.tomorrow.tomorrow)
end

Quando /^eu vou para a "([^\"]*)"$/ do |page|
  visit path_to(page)
end

Quando /^eu estou na ([^\"]*)$/ do |page|
  visit path_to(page)
end

Quando /^eu preencho "([^\"]*)" com uma data do ano que vem$/ do |campo|
  fill_in(campo, :with => Date.today.years_since(1))
end

Quando /^eu preencho "([^\"]*)" com uma data de um dia seguinte a partir de hoje$/ do |campo|
  fill_in(campo, :with => Date.tomorrow)
end

Quando /^eu marco "([^\"]*)"$/ do |field|
  check(field)
end

Quando /^eu escolho requisição de "([^\"]*)"$/ do |field|

  choose(field)

  if (field == "Ida e Volta")
    @ida_e_volta = true
  else
    @ida_e_volta = false
  end

end

Quando /^eu não marco "([^\"]*)"$/ do |field|
  uncheck(field)
end

Quando /^eu seleciono "([^\"]*)" em "([^\"]*)"$/ do |value, field|
  select(value, :from => field)
end

Quando /^eu preencho "([^\"]*)" com "([^\"]*)"$/ do |field, value|
  fill_in(field, :with => value)
end

Quando /^eu preencho data de reserva de volta com "([^\"]*)"$/ do |value|

  if (@ida_e_volta)
    fill_in('Data de Reserva de Volta', :with => value)
  end

end


Entao /^eu devo ver "([^\"]*)"$/ do |text|
  response.should contain(text)
end

Entao /^eu não devo ter requisições em espera$/ do
  requisicoes = Requisicao.all(:conditions => "estado = '"+ Requisicao::ESPERA + "'")
  requisicoes.should be_empty
end

